import{_ as x,k as _,b as d,c as i,d as e,e as h,y as k,F as f,x as b,v as m,i as y,t as g,w,f as p,z as v,n as A,p as M,g as C}from"./index-0a453887.js";const I={name:"AnnouncementView",data(){var r;return{announcements:[],currentPage:1,totalPages:1,loading:!0,showModal:!1,showDeleteModal:!1,selectedAnnouncement:null,isEditing:!1,sortBy:"newest",currentAnnouncement:{title:"",content:"",status:"active",imageUrl:null},getAnnouncement:_(),uploadFile:null,employeeID:((r=JSON.parse(localStorage.getItem("user")))==null?void 0:r.employeeID)||null,searchQuery:""}},computed:{sortedAnnouncements(){const r=[...this.announcements];switch(this.sortBy){case"newest":return r.sort((t,n)=>new Date(n.createdAt)-new Date(t.createdAt));case"oldest":return r.sort((t,n)=>new Date(t.createdAt)-new Date(n.createdAt));case"title":return r.sort((t,n)=>t.title.localeCompare(n.title,"th"));default:return r}},filteredAnnouncements(){if(!this.searchQuery)return this.sortedAnnouncements;const r=this.searchQuery.toLowerCase();return this.sortedAnnouncements.filter(t=>{var n;return t.title&&t.title.toLowerCase().includes(r)||t.content&&t.content.toLowerCase().includes(r)||((n=t.createdBy)==null?void 0:n.fullName)&&t.createdBy.fullName.toLowerCase().includes(r)})}},created(){this.fetchAnnouncements()},methods:{getThaiTimeISOString(r){return new Date(r).toLocaleString("th-TH",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1})},async fetchAnnouncements(){try{if(this.loading=!0,await this.getAnnouncement.getAnnouncementToAddAnnouncement(),this.getAnnouncement.showGetAnnouncement){const r=this.getAnnouncement.showGetAnnouncement;this.announcements=r.announcements.map(t=>({...t,imageUrl:t.imageUrl?"http://192.168.2.81/12chat"+t.imageUrl:null,isoString:this.getThaiTimeISOString(t.createdAt)})),this.currentPage=r.pagination.currentPage,this.totalPages=r.pagination.totalPages}}catch(r){console.error("Error fetching announcements:",r)}finally{this.loading=!1}},openCreateModal(){this.isEditing=!1,this.currentAnnouncement={title:"",content:"",status:"active",imageUrl:null},this.uploadFile=null,this.showModal=!0},openEditModal(r){this.isEditing=!0,this.currentAnnouncement={...r},this.showModal=!0},closeModal(){this.showModal=!1,this.currentAnnouncement={title:"",content:"",status:"active",imageUrl:null},this.uploadFile=null},async createAnnouncement(){var r,t,n;try{this.loading=!0;const c=((r=JSON.parse(localStorage.getItem("user")))==null?void 0:r.employeeID)||null,o=new FormData;o.append("title",this.currentAnnouncement.title),o.append("content",this.currentAnnouncement.content),o.append("employeeID",c),this.uploadFile&&o.append("image",this.uploadFile);const a=await this.getAnnouncement.createAnnouncement(o);if(a.statusCode===200)this.closeModal(),this.fetchAnnouncements(),alert("สร้างประกาศสำเร็จ");else throw new Error(a.message||"เกิดข้อผิดพลาดในการสร้างประกาศ")}catch(c){console.error("Error creating announcement:",c),alert(((n=(t=c.response)==null?void 0:t.data)==null?void 0:n.message)||c.message||"เกิดข้อผิดพลาดในการสร้างประกาศ")}finally{this.loading=!1,this.uploadFile=null}},async updateAnnouncement(){var r;try{const t=((r=JSON.parse(localStorage.getItem("user")))==null?void 0:r.employeeID)||null,n=new FormData;n.append("title",this.currentAnnouncement.title),n.append("id",this.currentAnnouncement.id),n.append("content",this.currentAnnouncement.content),n.append("employeeID",t),this.uploadFile&&n.append("image",this.uploadFile);const c=await this.getAnnouncement.updateAnnouncement(n);await new Promise(o=>setTimeout(o,1e3)),this.closeModal(),this.fetchAnnouncements()}catch(t){console.error("Error updating announcement:",t)}},async toggleAnnouncementStatus(r){var t;try{const n=((t=JSON.parse(localStorage.getItem("user")))==null?void 0:t.employeeID)||null,c=await this.getAnnouncement.updateStatusAnnouncement(r._id,n,r.status);await new Promise(o=>setTimeout(o,500)),r.status=r.status==="active"?"inactive":"active",this.fetchAnnouncements()}catch(n){console.error("Error toggling announcement status:",n)}},async deleteAnnouncement(r){var t;try{const n=((t=JSON.parse(localStorage.getItem("user")))==null?void 0:t.employeeID)||null,c=await this.getAnnouncement.deleteAnnouncement(r.id,n);await new Promise(o=>setTimeout(o,1e3)),this.closeDeleteModal(),this.fetchAnnouncements()}catch(n){console.error("Error deleting announcement:",n)}},confirmDelete(r){this.selectedAnnouncement=r,this.showDeleteModal=!0},closeDeleteModal(){this.showDeleteModal=!1,this.selectedAnnouncement=null},changePage(r){this.currentPage=r,this.fetchAnnouncements()},handleImageUpload(r){const t=r.target.files[0];if(t){if(t.size>2*1024*1024){alert("ไฟล์มีขนาดใหญ่เกินไป (สูงสุด 2MB)");return}if(!t.type.startsWith("image/")){alert("กรุณาอัพโหลดไฟล์รูปภาพเท่านั้น");return}this.uploadFile=t;const n=new FileReader;n.onload=c=>{this.currentAnnouncement.imageUrl=c.target.result},n.readAsDataURL(t)}},removeImage(){this.currentAnnouncement.imageUrl=null,this.uploadFile=null},handleImageError(r){r.target.src="https://via.placeholder.com/40"}}},l=r=>(M("data-v-74df3cdd"),r=r(),C(),r),D={class:"p-4 sm:ml-32"},S={class:"p-4 mt-14"},E={class:"flex justify-between items-center mb-6"},U={class:"flex items-start justify-between gap-2"},P=l(()=>e("h1",{class:"text-xl font-bold text-gray-900 dark:text-white"},"จัดการประกาศ",-1)),F=l(()=>e("option",{value:"newest"},"ใหม่ล่าสุด",-1)),j=l(()=>e("option",{value:"oldest"},"เก่าสุด",-1)),B=l(()=>e("option",{value:"title"},"ตามหัวข้อ",-1)),N=[F,j,B],V={class:"flex justify-center px-1"},T={class:"inline-flex gap-2 rounded-md"},z=["onClick"],L={class:"flex justify-center px-1"},O={class:"max-w-md mx-auto"},G=l(()=>e("label",{for:"default-search",class:"mb-2 text-sm font-medium text-gray-900 sr-only dark:text-white"},"Search",-1)),J={class:"relative"},Q=l(()=>e("div",{class:"absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none"},[e("svg",{class:"w-4 h-4 text-gray-500 dark:text-gray-400","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 20 20"},[e("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"})])],-1)),H=l(()=>e("i",{class:"fas fa-plus mr-2"},null,-1)),q={key:0,class:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm z-[9999] flex items-center justify-center"},R=l(()=>e("div",{class:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-2xl flex flex-col items-center min-w-[200px]"},[e("div",{class:"animate-spin rounded-full h-10 w-10 border-4 border-blue-600 border-t-transparent mb-3"}),e("p",{class:"text-gray-700 dark:text-gray-300 font-medium"},"กำลังโหลด...")],-1)),W=[R],X={key:1,class:"text-center py-12"},Z=l(()=>e("i",{class:"fas fa-bullhorn text-4xl text-gray-400 mb-4"},null,-1)),K=l(()=>e("p",{class:"text-gray-500 dark:text-gray-400"},"ยังไม่มีประกาศ",-1)),Y=[Z,K],$={key:2,class:"relative overflow-x-auto overflow-y-auto h-[70vh] shadow-md sm:rounded-lg"},ee={class:"w-full text-sm text-left text-gray-500 dark:text-gray-400"},te=l(()=>e("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3"},"รูปภาพ"),e("th",{scope:"col",class:"px-6 py-3"},"หัวข้อ"),e("th",{scope:"col",class:"px-6 py-3"},"เนื้อหา"),e("th",{scope:"col",class:"px-6 py-3"},"ผู้สร้าง"),e("th",{scope:"col",class:"px-6 py-3"},"วันที่สร้าง"),e("th",{scope:"col",class:"px-6 py-3"},"สถานะ"),e("th",{scope:"col",class:"px-6 py-3"},"จัดการ")])],-1)),re={class:"px-6 py-4"},se=["src","alt","onClick"],oe={key:1,class:"text-gray-400"},ne=["onClick"],ae=["onClick"],le={class:"px-6 py-4"},de={class:"px-6 py-4"},ie={class:"px-6 py-4"},ce={class:"relative inline-flex items-center cursor-pointer"},ue=["checked","onClick"],ge=l(()=>e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"},null,-1)),he={class:"px-6 py-4"},me={class:"flex items-center space-x-3"},pe=["onClick"],fe=l(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M3 17.46v3.04c0 .28.22.5.5.5h3.04c.13 0 .26-.05.35-.15L17.81 9.94l-3.75-3.75L3.15 17.1q-.15.15-.15.36M20.71 7.04a.996.996 0 0 0 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83l3.75 3.75z"})],-1)),ye=[fe],be=["onClick"],xe=l(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M19 4h-3.5l-1-1h-5l-1 1H5v2h14M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6z"})],-1)),_e=[xe],ke={key:3,class:"fixed inset-0 bg-gray-900 bg-opacity-50 overflow-y-auto h-full w-full z-50"},we={class:"relative top-20 mx-auto p-5 border w-[600px] shadow-lg rounded-md bg-white dark:bg-gray-800"},ve={class:"flex justify-between items-center mb-4"},Ae={class:"text-lg font-medium text-gray-900 dark:text-white"},Me=l(()=>e("i",{class:"fas fa-times"},null,-1)),Ce=[Me],Ie={class:"mb-4"},De=l(()=>e("label",{for:"title",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},"หัวข้อ",-1)),Se={class:"mb-4"},Ee=l(()=>e("label",{for:"content",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},"เนื้อหา",-1)),Ue={class:"mb-4"},Pe=l(()=>e("label",{class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},"รูปภาพ",-1)),Fe={class:"flex items-center justify-center w-full"},je={for:"image-upload",class:"flex flex-col items-center justify-center w-full h-64 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:hover:bg-gray-800 dark:bg-gray-700 hover:bg-gray-100 dark:border-gray-600 dark:hover:border-gray-500 dark:hover:bg-gray-600"},Be={class:"flex flex-col items-center justify-center pt-5 pb-6"},Ne=l(()=>e("i",{class:"fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"},null,-1)),Ve=l(()=>e("p",{class:"mb-2 text-sm text-gray-500 dark:text-gray-400"},[e("span",{class:"font-semibold"},"คลิกเพื่ออัพโหลด"),y(" หรือลากไฟล์มาวาง ")],-1)),Te=l(()=>e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"PNG, JPG หรือ GIF (MAX. 2MB)",-1)),ze=["src"],Le={key:0,class:"mt-2 flex justify-end"},Oe=l(()=>e("i",{class:"fas fa-trash mr-1"},null,-1)),Ge={class:"flex justify-end space-x-2"},Je={type:"submit",class:"text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800"},Qe={key:4,class:"fixed inset-0 bg-gray-900 bg-opacity-50 overflow-y-auto h-full w-full z-50"},He={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white dark:bg-gray-800"},qe={class:"mt-3 text-center"},Re=v('<div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 dark:bg-red-900" data-v-74df3cdd><i class="fas fa-exclamation-triangle text-red-600 dark:text-red-300" data-v-74df3cdd></i></div><h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white mt-4" data-v-74df3cdd>ยืนยันการลบ</h3><div class="mt-2 px-7 py-3" data-v-74df3cdd><p class="text-sm text-gray-500 dark:text-gray-400" data-v-74df3cdd> คุณต้องการลบประกาศ ใช่หรือไม่? </p></div>',3),We={class:"flex justify-center space-x-2 mt-4"};function Xe(r,t,n,c,o,a){return d(),i("div",D,[e("div",S,[e("div",E,[e("div",U,[P,h(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>o.sortBy=s),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full md:w-auto p-1.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"},N,512),[[k,o.sortBy]]),e("div",V,[e("nav",T,[(d(!0),i(f,null,b(o.totalPages,s=>(d(),i("button",{key:s,onClick:u=>a.changePage(s),class:A(["px-3 py-1.5 text-sm font-medium shadow-md rounded-md",o.currentPage===s?"bg-blue-600 text-white ":"bg-white text-gray-700 shadow-md hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700"])},g(s),11,z))),128))])]),e("div",L,[e("form",O,[G,e("div",J,[Q,h(e("input",{type:"search",id:"default-search","onUpdate:modelValue":t[1]||(t[1]=s=>o.searchQuery=s),class:"block w-full p-4 py-2 ps-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:"ค้นหาประกาศ..."},null,512),[[m,o.searchQuery]])])])])]),e("button",{onClick:t[2]||(t[2]=(...s)=>a.openCreateModal&&a.openCreateModal(...s)),class:"text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800"},[H,y("สร้างประกาศใหม่ ")])]),o.loading?(d(),i("div",q,W)):o.announcements.length===0?(d(),i("div",X,Y)):(d(),i("div",$,[e("table",ee,[te,e("tbody",null,[(d(!0),i(f,null,b(a.filteredAnnouncements,s=>(d(),i("tr",{key:s._id,class:"bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"},[e("td",re,[s.imageUrl?(d(),i("img",{key:0,src:s.imageUrl,alt:s.title,class:"w-16 h-16 object-cover rounded-lg cursor-pointer",onClick:u=>a.openEditModal(s),onError:t[3]||(t[3]=(...u)=>a.handleImageError&&a.handleImageError(...u))},null,40,se)):(d(),i("span",oe,"ไม่มีรูปภาพ"))]),e("td",{class:"px-6 py-4 font-medium text-gray-900 dark:text-white cursor-pointer",onClick:u=>a.openEditModal(s)},g(s.title),9,ne),e("td",{class:"px-6 py-4 max-w-xs truncate cursor-pointer",onClick:u=>a.openEditModal(s)},g(s.content),9,ae),e("td",le,g(s.createdBy.fullName),1),e("td",de,g(s.isoString),1),e("td",ie,[e("label",ce,[e("input",{type:"checkbox",checked:s.status==="active",onClick:u=>a.toggleAnnouncementStatus(s),class:"sr-only peer"},null,8,ue),ge])]),e("td",he,[e("div",me,[e("button",{onClick:u=>a.openEditModal(s),class:"font-medium text-blue-600 dark:text-blue-500 hover:underline"},ye,8,pe),e("button",{onClick:u=>a.confirmDelete(s),class:"font-medium text-red-600 dark:text-red-500 hover:underline"},_e,8,be)])])]))),128))])])])),o.showModal?(d(),i("div",ke,[e("div",we,[e("div",ve,[e("h3",Ae,g(o.isEditing?"แก้ไขประกาศ":"สร้างประกาศใหม่"),1),e("button",{onClick:t[4]||(t[4]=(...s)=>a.closeModal&&a.closeModal(...s)),class:"text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-600 dark:hover:text-white"},Ce)]),e("form",{onSubmit:t[12]||(t[12]=w(s=>o.isEditing?a.updateAnnouncement():a.createAnnouncement(),["prevent"]))},[e("div",Ie,[o.isEditing?h((d(),i("input",{key:0,type:"hidden",id:"id","onUpdate:modelValue":t[5]||(t[5]=s=>o.currentAnnouncement.id=s)},null,512)),[[m,o.currentAnnouncement.id]]):p("",!0),De,h(e("input",{type:"text",id:"title","onUpdate:modelValue":t[6]||(t[6]=s=>o.currentAnnouncement.title=s),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:"กรอกหัวข้อประกาศ"},null,512),[[m,o.currentAnnouncement.title]])]),e("div",Se,[Ee,h(e("textarea",{id:"content","onUpdate:modelValue":t[7]||(t[7]=s=>o.currentAnnouncement.content=s),rows:"4",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:"กรอกเนื้อหาประกาศ"},null,512),[[m,o.currentAnnouncement.content]])]),e("div",Ue,[Pe,e("div",Fe,[e("label",je,[e("div",Be,[o.currentAnnouncement.imageUrl?(d(),i("img",{key:1,src:o.currentAnnouncement.imageUrl,class:"max-h-48 rounded-lg",alt:"Preview",onError:t[8]||(t[8]=(...s)=>a.handleImageError&&a.handleImageError(...s))},null,40,ze)):(d(),i(f,{key:0},[Ne,Ve,Te],64))]),e("input",{id:"image-upload",type:"file",class:"hidden",accept:"image/*",onChange:t[9]||(t[9]=(...s)=>a.handleImageUpload&&a.handleImageUpload(...s))},null,32)])]),o.currentAnnouncement.imageUrl?(d(),i("div",Le,[e("button",{type:"button",onClick:t[10]||(t[10]=(...s)=>a.removeImage&&a.removeImage(...s)),class:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 text-sm"},[Oe,y("ลบรูปภาพ ")])])):p("",!0)]),e("div",Ge,[e("button",{type:"button",onClick:t[11]||(t[11]=(...s)=>a.closeModal&&a.closeModal(...s)),class:"text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-blue-300 rounded-lg border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-500 dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-gray-600"}," ยกเลิก "),e("button",Je,g(o.isEditing?"บันทึก":"สร้าง"),1)])],32)])])):p("",!0),o.showDeleteModal?(d(),i("div",Qe,[e("div",He,[e("div",qe,[Re,e("div",We,[e("button",{onClick:t[13]||(t[13]=(...s)=>a.closeDeleteModal&&a.closeDeleteModal(...s)),class:"text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-blue-300 rounded-lg border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-500 dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-gray-600"}," ยกเลิก "),e("button",{onClick:t[14]||(t[14]=s=>a.deleteAnnouncement(o.selectedAnnouncement)),class:"text-white bg-red-600 hover:bg-red-700 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 dark:bg-red-600 dark:hover:bg-red-700 focus:outline-none dark:focus:ring-red-800"}," ลบ ")])])])])):p("",!0)])])}const Ke=x(I,[["render",Xe],["__scopeId","data-v-74df3cdd"]]);export{Ke as default};
